---
import { t, type Locale } from '../i18n/translations';

interface Props {
  locale: Locale;
  currentPath: string;
}

const { locale, currentPath } = Astro.props;

const base = import.meta.env.BASE_URL; // '/ing-civil/'

const navItems = [
  { key: 'nav.home', href: `${base}${locale}/` },
  { key: 'nav.projects', href: `${base}${locale}/proyectos` },
  { key: 'nav.cv', href: `${base}${locale}/cv` },
  { key: 'nav.contact', href: `${base}${locale}/contacto` },
] as const;

const otherLocale: Locale = locale === 'es' ? 'en' : 'es';
const switchPath = currentPath.replace(`/${locale}/`, `/${otherLocale}/`);
---

<nav class="sticky top-0 z-50 bg-white/95 backdrop-blur-sm border-b border-blueprint-blue/20 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo / Brand -->
      <a href={`${base}${locale}/`} class="flex items-center space-x-2 group">
        <svg class="w-8 h-8 text-blueprint-blue group-hover:text-safety-orange transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
        </svg>
        <span class="font-heading text-lg font-bold text-blueprint-blue hidden sm:block">
          {locale === 'es' ? 'Ing. Civil' : 'Civil Eng.'}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-8">
        {navItems.map(item => (
          <a 
            href={item.href}
            class:list={[
              "font-medium text-sm hover:text-blueprint-blue transition-colors",
              currentPath.startsWith(item.href) && item.href !== `/${locale}/`
                ? "text-blueprint-blue border-b-2 border-blueprint-blue"
                : "text-gray-700"
            ]}
          >
            {t(locale, item.key)}
          </a>
        ))}
        
        <!-- Language Switcher -->
        <a 
          href={switchPath}
          class="flex items-center space-x-1 px-3 py-1.5 rounded-md bg-blueprint-blue/10 hover:bg-blueprint-blue/20 text-blueprint-blue font-mono text-sm transition-colors"
          aria-label={locale === 'es' ? 'Switch to English' : 'Cambiar a Español'}
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
          </svg>
          <span class="font-semibold">{otherLocale.toUpperCase()}</span>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button 
        id="mobile-menu-button"
        class="md:hidden p-2 rounded-md text-gray-700 hover:text-blueprint-blue hover:bg-blueprint-blue/10 transition-colors"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="hidden md:hidden border-t border-blueprint-blue/20 bg-white">
    <div class="px-4 py-4 space-y-3">
      {navItems.map(item => (
        <a 
          href={item.href}
          class:list={[
            "block px-3 py-2 rounded-md font-medium text-sm transition-colors",
            currentPath.startsWith(item.href) && item.href !== `/${locale}/`
              ? "bg-blueprint-blue text-white"
              : "text-gray-700 hover:bg-blueprint-blue/10 hover:text-blueprint-blue"
          ]}
        >
          {t(locale, item.key)}
        </a>
      ))}
      
      <a 
        href={switchPath}
        class="flex items-center justify-center space-x-2 px-3 py-2 rounded-md bg-blueprint-blue/10 hover:bg-blueprint-blue/20 text-blueprint-blue font-mono text-sm transition-colors"
      >
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129" />
        </svg>
        <span class="font-semibold">{locale === 'es' ? 'English' : 'Español'}</span>
      </a>
    </div>
  </div>
</nav>

<script>
  // Mobile menu toggle
  const button = document.getElementById('mobile-menu-button');
  const menu = document.getElementById('mobile-menu');
  
  button?.addEventListener('click', () => {
    menu?.classList.toggle('hidden');
  });
  
  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!button?.contains(e.target as Node) && !menu?.contains(e.target as Node)) {
      menu?.classList.add('hidden');
    }
  });
</script>
