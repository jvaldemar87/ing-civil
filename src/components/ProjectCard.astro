---
import ImagePlaceholder from "./ImagePlaceholder.astro";
import type { FeaturedProject } from "../data/featuredProjects";
import type { Locale } from "../i18n/translations";

interface Props {
    project: FeaturedProject;
    locale: Locale;
}

const { project, locale } = Astro.props;
const base = import.meta.env.BASE_URL;

// Construct image path for AVIF format
const imagePath = `/images/projects/${project.id}/featured.avif`;
const fullImagePath = `${base.replace(/\/$/, "")}${imagePath}`;
---

<article class="project-card group h-full">
    <div
        class="h-full flex flex-col bg-white border-2 border-blueprint-blue/20 rounded-md overflow-hidden hover:border-safety-orange hover:shadow-blueprint transition-all duration-300"
    >
        <!-- Image Container -->
        <div class="relative overflow-hidden aspect-video bg-gray-100">
            <!-- Real Image (AVIF) - will show if file exists -->
            <img
                src={fullImagePath}
                alt={project.titulo[locale]}
                class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                loading="lazy"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
            />

            <!-- Placeholder - shown when image doesn't exist -->
            <div style="display: none;">
                <ImagePlaceholder
                    projectName={project.titulo[locale]}
                    projectType={project.tipo}
                />
            </div>

            <!-- Tags Overlay -->
            <div class="absolute top-3 left-3 flex flex-wrap gap-2">
                {
                    project.tags[locale].slice(0, 2).map((tag) => (
                        <span
                            class="px-2 py-1 text-white text-xs font-mono font-semibold rounded shadow-md"
                            style="background-color: #FF5733;"
                        >
                            {tag}
                        </span>
                    ))
                }
            </div>
        </div>

        <!-- Content -->
        <div class="flex-1 p-5 flex flex-col">
            <!-- Dimension Line -->
            <div class="dimension-line mb-4"></div>

            <!-- Title -->
            <h3
                class="font-heading text-lg font-bold text-blueprint-blue mb-2 line-clamp-2 group-hover:text-safety-orange transition-colors"
            >
                {project.titulo[locale]}
            </h3>

            <!-- Client -->
            <p class="text-sm text-gray-600 mb-3 font-medium">
                <span
                    class="font-mono text-xs text-gray-500 uppercase tracking-wide"
                >
                    {locale === "es" ? "Cliente:" : "Client:"}
                </span>
                <br />
                {project.cliente}
            </p>

            <!-- Description -->
            <p class="text-sm text-gray-700 mb-4 flex-1 line-clamp-3">
                {project.descripcion[locale]}
            </p>

            <!-- Technical Data -->
            <div class="space-y-2 mb-4">
                <!-- Period -->
                <div class="flex items-center gap-2 text-xs">
                    <svg
                        class="w-4 h-4 text-blueprint-blue"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                    </svg>
                    <span class="font-mono text-gray-600"
                        >{project.periodo}</span
                    >
                </div>

                <!-- Location -->
                <div class="flex items-center gap-2 text-xs">
                    <svg
                        class="w-4 h-4 text-blueprint-blue"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        ></path>
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    </svg>
                    <span class="font-mono text-gray-600"
                        >{project.ubicacion[locale]}</span
                    >
                </div>

                <!-- Length (if available) -->
                {
                    project.longitud && (
                        <div class="flex items-center gap-2 text-xs">
                            <svg
                                class="w-4 h-4 text-blueprint-blue"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                                />
                            </svg>
                            <span class="font-mono text-gray-600">
                                {project.longitud}
                            </span>
                        </div>
                    )
                }
            </div>

            <!-- Dimension Line -->
            <div class="dimension-line mb-4"></div>

            <!-- View More Link -->
            <a
                href={`${base}${locale}/proyectos/${project.id}`}
                class="inline-flex items-center gap-2 text-sm font-semibold text-blueprint-blue hover:text-safety-orange transition-colors group/link"
            >
                <span>{locale === "es" ? "Ver Detalles" : "View Details"}</span>
                <svg
                    class="w-4 h-4 group-hover/link:translate-x-1 transition-transform"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
</article>

<style>
    .project-card {
        position: relative;
    }

    /* Blueprint corner markers on hover */
    .project-card:hover::before,
    .project-card:hover::after {
        content: "";
        position: absolute;
        width: 12px;
        height: 12px;
        border: 2px solid var(--color-safety-orange, #ff5733);
        opacity: 0.6;
        transition: opacity 0.3s;
    }

    .project-card:hover::before {
        top: -2px;
        left: -2px;
        border-right: none;
        border-bottom: none;
    }

    .project-card:hover::after {
        bottom: -2px;
        right: -2px;
        border-left: none;
        border-top: none;
    }
</style>
